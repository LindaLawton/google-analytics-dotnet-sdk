language: csharp
mono: none
dotnet: 2.1
dist: trusty

# Add build var for release.
env:
  BUILD_CONFIGURATION=Release
  NUPKG_DIR=$(pwd)/NuPkgs/Generated

# Install the .NET Core 2.0 runtime as that's what we build and test against
addons:
  apt:
    sources:
    - sourceline: 'deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-trusty-prod trusty main'
      key_url: 'https://packages.microsoft.com/keys/microsoft.asc'
    packages:
    - dotnet-sharedframework-microsoft.netcore.app-1.0.8
    - dotnet-sharedframework-microsoft.netcore.app-1.1.5

script:
  - dotnet build -c $BUILD_CONFIGURATION src/Google.Analytics.SDK.Core
  - dotnet build -c $BUILD_CONFIGURATION tests/Google.Analytics.SDK.Tests
  - dotnet test -c $BUILD_CONFIGURATION tests/Google.Analytics.SDK.Tests 
  - dotnet pack src/Google.Analytics.SDK.Core --configuration $BUILD_CONFIGURATION --no-restore --no-build --output $NUPKG_DIR
  - ls -la $NUPKG_DIR/*.nupkg
  - ls -la ./deploy
  - chmod +x ./deploy/deploy.sh
deploy:
  skip_cleanup: true
  provider: script
  script: bash deploy/deploy.sh $NuGetAPIKey $NUPKG_DIR
  on:
    branch: master
  
  
